<tool id="galaxy.qc" name="Quality Checks" version="0.1.0">
  <description>Extract run information from tools used in pipeline.</description>

  <macros>
    <import>macros.xml</import>
  </macros>

  <expand macro="requirements"/>
  
  <command detect_errors="exit_code">
    <![CDATA[
	     #for $input in $input_fastq#
	     echo '$input.element_identifier' >> $fastq_names;
	     #end for#
	     
	     #for $spike in $spike_counts#
	     echo '$spike.element_identifier' >> $spike_names;
	     #end for#
	     
	     #for $despiked in $despiked_fastq#
	     echo '$despiked.element_identifier' >> $despiked_names;
	     #end for#

	     #for $align in $align_reports#
	     echo '$align.element_identifier' >> $align_names;
	     #end for#
	     
	     #for $assemble in $assemble_reports#
	     echo '$assemble.element_identifier' >> $assemble_names;
	     #end for#
	     
	     #for $d_qc in $decontam_qc#
	     echo '$d_qc.element_identifier' >> $decontam_qc_names;
	     #end for#
	     
	     #for $d_clones in $decontam_clones#
	     echo '$d_clones.element_identifier' >> $decontam_clones_names;
	     #end for#
	     
	     #for $norm in $norm_clones#
	     echo '$norm.element_identifier' >> $norm_names;
	     #end for#

	     Rscript $__tool_directory__/galaxy.qc.R
	     $input_fastq $fastq_names
	     $spike_counts $spike_names
	     $despiked_fastq $despiked_names
	     $count_output

	     $align_reports $align_names
	     $align_output
	     
	     $assemble_reports $assemble_names
	     $assemble_output
	     
	     $decontam_qc $decontam_qc_names $decontam_qc_output
	     
	     $decontam_clones $decontam_clones_names
	     $norm_clones $norm_names
	     $norm_output 

             $debug
    ]]>
  </command>
    
  <inputs>
    <!--Count and Remove Spikes-->
    <param name="input_fastq" type="data" multiple="True" format="fastq" label="PEARed Fastq"
	   help="Data collection of PEARed fastq files, for count spikes QC."/>
    <param name="spike_counts" type="data" format="tabular" label="Spike Counts" multiple="True"
	   help="Data collection of 25-bp spike count files, for count spikes QC."/>
    <param name="despiked_fastq" type="data" format="fastq" multiple="True" label="Despiked Fastq"
	   help="Data collection of PEARed fastq files, with spiked reads identified by 9-bp count spikes removed. For count spikes QC."/>

    <!--MiXCR-->
    <param name="align_reports" type="data" format="data" multiple="True" label="Align Report"
	   help="Data collection of report files generated by MiXCR Align."/>
    <param name="assemble_reports" type="data" format="data" multiple="True" label="Assemble Report"
	   help="Data collection of report files generated by MiXCR Assemble."/>

    <!--Decontamination-->
    <param name="decontam_qc" type="data" format="tabular" multiple="True" label="Decontamination QC"
	   help="Individual QC files generated during decontamination."/>

    <!--Normalization-->
    <param name="decontam_clones" type="data" format="tabular" multiple="True" label="Raw/Decontaminated Clonotype Counts"
	   help="Data collection of clonotype count files generated by exportClones. And also decontaminated. For normalization QC."/>
    <param name="norm_clones" type="data" format="tabular" multiple="True" label="Normalized Clonotype Counts"
	   help="Data collection of normalized clonotype count files. Generated by exportClones, with counts normalized using scaling factor."/>

    <!--Debug-->
    <param name="debug" type="boolean" checked="true" label="Run Debug (T/F)"/>
  </inputs>

  <outputs>
    <!--Count and Remove Spikes-->
    <data name="fastq_names" hidden="true" format="tabular" label="PEARed Fastq Names"/>
    <data name="spike_names" hidden="true" format="tabular" label="Spike Count Names"/>
    <data name="despiked_names" hidden="true" format="tabular" label="Despiked Fastq Names"/>
    <data name="count_output" format="tabular" label="Count Spikes QC"/>
    <!--MiXCR-->
    <data name="align_names" hidden="true" format="tabular" label="Align Names"/>
    <data name="align_output" format="tabular" label="MiXCR Align QC"/>
    <data name="assemble_names" hidden="true" format="tabular" label="Assemble Names"/>
    <data name="assemble_output" format="tabular" label="MiXCR Assemble QC"/>
    <!--Decontamination-->
    <data name="decontam_qc_names" hidden="true" format="tabular" label="Decontam QC Names"/>
    <data name="decontam_qc_output" format="tabular" label="Combined_Decontamination_QC"/>
    <!--Normalization-->
    <data name="decontam_clones_names" hidden="true" format="tabular" label="Decontam Clone Names"/>
    <data name="norm_names" hidden="true" format="tabular" label="Normalized Clone Names"/>
    <data name="norm_output" format="tabular" label="Normalization QC"/>
  </outputs>

  <help>
    This tool calculates various QC metrics for count/remove spikes, mixcr align, mixcr assemble, and normalization. Figure out how to format help better and make this more specific.
  </help>

  <citations>
  </citations>

</tool>
